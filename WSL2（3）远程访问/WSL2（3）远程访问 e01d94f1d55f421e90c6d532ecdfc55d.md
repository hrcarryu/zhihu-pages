# WSL2ï¼ˆ3ï¼‰è¿œç¨‹è®¿é—®

æ—¶é—´: May 13, 2022 8:49 PM
æ ‡ç­¾: WSL2, è¿œç¨‹è®¿é—®
çŠ¶æ€: Yes
ç±»å‹: æ“ä½œç³»ç»Ÿ

# 1. windows SSHè®¿é—®

<aside>
ğŸ’¡ å¯ä»¥é€šè¿‡windowsè‡ªå¸¦çš„openSSHæœåŠ¡å™¨æä¾›SSHæœåŠ¡ï¼Œå…·ä½“æ–¹æ³•å‚è€ƒ[SSHï¼šè®°å½•](https://www.notion.so/SSH-3ac6c80316544ead93d0939be050ff4c) ï¼Œé€šè¿‡ä¿®æ”¹é»˜è®¤ç»ˆç«¯çš„æ–¹å¼ç›´æ¥è®¿é—®WSL2çš„linuxç»ˆç«¯ã€‚

</aside>

è¿æ¥ä¸ŠSSHåï¼Œé»˜è®¤çš„ç»ˆç«¯æ˜¯cmdï¼Œå¯ä»¥é€šè¿‡powershellæˆ–wslå‘½ä»¤è¿›å…¥ä¸åŒçš„ç»ˆç«¯ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ä¸‹é¢å‘½ä»¤é»˜è®¤è¿›å…¥WSLç»ˆç«¯ã€‚

```powershell
# é»˜è®¤powershell
**New-ItemProperty -Path "HKLM:\SOFTWARE\OpenSSH" -Name DefaultShell -Value "C:\Windows\System32\WindowsPowerShell\v1.0\powershell.exe" -PropertyType String -Force**
# é»˜è®¤wsl
New-ItemProperty -Path "HKLM:\SOFTWARE\OpenSSH" -Name DefaultShell -Value "C:\WINDOWS\System32\bash.exe" -PropertyType String -Force
```

> **5.8æ›´æ–°**ï¼šwslæ›´æ–°é¢„è§ˆç‰ˆåè¯¥æ–¹æ³•å·²å¤±æ•ˆï¼Œå› ä¸ºæ–°ç‰ˆæœ¬ä¸‹é€šè¿‡sshæ— æ³•è®¿é—®wslï¼Œåäº†ã€‚
> 

æ­¤æ—¶å°±å¯ä»¥é€šè¿‡VSCodeçš„remote SSHæ’ä»¶è¿æ¥åŒä¸€å±€åŸŸç½‘ä¸‹çš„ä¸»æœºäº†ã€‚

<aside>
â˜¹ï¸ åé¢SSHå…å¯†ç™»å½•è¿˜æ˜¯æ²¡æœ‰æˆåŠŸï¼Œä¸çŸ¥é“ä»€ä¹ˆåœ°æ–¹çš„åŸå› ã€‚

</aside>

# 2. Ubuntu SSHè®¿é—®

<aside>
ğŸ’¡ åé¢å‘ç°å¯ä»¥é€šè¿‡ç«¯å£è½¬å‘çš„å½¢å¼è®¿é—®Ubuntuçš„SSHæœåŠ¡ï¼Œäºæ˜¯æœ‰äº†æ–°çš„è®¿é—®æ–¹æ³•ã€‚

</aside>

## 2.1 å¼€å¯SSHæœåŠ¡

å¯ä»¥å‚è€ƒ[SSHï¼šè®°å½•](https://www.notion.so/SSH-3ac6c80316544ead93d0939be050ff4c) ï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š

```bash
# å®‰è£…openssh-server
sudo apt-get update
sudo apt-get install openssh-server
# é…ç½®
sudo vi /etc/ssh/sshd_config
```

æ·»åŠ ä¸‹é¢è¿™éƒ¨åˆ†å†…å®¹ï¼ˆå®ƒä»¬è¢«æ³¨é‡Šæ‰äº†ï¼Œå–æ¶ˆæ³¨é‡Šå³å¯ï¼‰ï¼Œå…¶å®ƒå†…å®¹æ²¡å¿…è¦æ”¹å˜ã€‚

```bash
Port 2111 # ç«¯å£å· é»˜è®¤22
AddressFamily any
ListenAddress 0.0.0.0
ListenAddress ::
PasswordAuthentication yes # æ˜¯å¦å…è®¸ä½¿ç”¨å¯†ç ç™»å½•
```

å¯ä»¥çœ‹åˆ°æˆ‘ä»¬é‡‡ç”¨2111ä½œä¸ºSSHçš„ç«¯å£ï¼Œåé¢ç«¯å£è½¬å‘éœ€è¦ç”¨åˆ°ã€‚SSHçš„å¼€å¯å‘½ä»¤å¦‚ä¸‹ï¼š

```bash
sudo service ssh start
```

## 2.2 ç«¯å£è½¬å‘

é¦–å…ˆæŸ¥çœ‹linuxçš„ipï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š

```bash
# æŸ¥çœ‹ipåœ°å€
ifconfig
# å¾—åˆ°çš„ç»“æœï¼Œå…¶ä¸­172.21.52.180å³WSL2çš„ipåœ°å€
eth0: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500
        inet 172.21.52.180  netmask 255.255.240.0  broadcast 172.21.63.255
        inet6 fe80::215:5dff:fece:5e68  prefixlen 64  scopeid 0x20<link>
        ether 00:15:5d:ce:5e:68  txqueuelen 1000  (Ethernet)
        RX packets 0  bytes 0 (0.0 B)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 8  bytes 656 (656.0 B)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0

lo: flags=73<UP,LOOPBACK,RUNNING>  mtu 65536
        inet 127.0.0.1  netmask 255.0.0.0
        inet6 ::1  prefixlen 128  scopeid 0x10<host>
        loop  txqueuelen 1000  (Local Loopback)
        RX packets 0  bytes 0 (0.0 B)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 0  bytes 0 (0.0 B)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0
```

ç„¶åç®¡ç†å‘˜æƒé™æ‰“å¼€powershellï¼Œè¾“å…¥å¦‚ä¸‹å‘½ä»¤ï¼Œè¯¦ç»†å‚è€ƒ[PowerShellï¼šè®°å½•](https://www.notion.so/PowerShell-d4c4f09d3eb94b6d83ef089497d63ffc) ã€‚

```bash
# ç«¯å£è½¬å‘ï¼Œæ‰€æœ‰0.0.0.0çš„ä¸»æœºå‘å¾€win10:2233ç«¯å£çš„tcpä¿¡æ¯éƒ½ä¼šè½¬å‘åˆ°172.21.52.180ï¼š2111
netsh interface portproxy set v4tov4 listenport=2233 listenaddress=0.0.0.0 connectport=2111 connectaddress=172.21.53.185
```

## 2.3 é˜²ç«å¢™è®¾ç½®

æ­¤æ—¶æœ¬åœ°å°±å¯ä»¥è¿æ¥WSL2çš„SSHï¼Œä½†æ˜¯ç”±äºé˜²ç«å¢™ï¼Œå±€åŸŸç½‘å†…å…¶ä»–ä¸»æœºæ— æ³•è®¿é—®åˆ°ã€‚å¯ä»¥å…³é—­é˜²ç«å¢™ï¼Œæˆ–è€…è®¾ç½®é˜²ç«å¢™è§„åˆ™ï¼Œå¦‚ä¸‹ã€‚

ä¾æ¬¡ç‚¹å‡»windowså®‰å…¨ä¸­å¿ƒ-ã€‹é˜²ç«å¢™å’Œç½‘ç»œä¿æŠ¤-ã€‹é«˜çº§è®¾ç½®-ã€‹å…¥ç«™è§„åˆ™-ã€‹æ–°å»ºè§„åˆ™ï¼Œå¾—åˆ°å¦‚ä¸‹ï¼š

![Untitled](WSL2%EF%BC%883%EF%BC%89%E8%BF%9C%E7%A8%8B%E8%AE%BF%E9%97%AE%20e01d94f1d55f421e90c6d532ecdfc55d/Untitled.png)

ç„¶åå¦‚ä¸‹é…ç½®ï¼š

1. è§„åˆ™ç±»å‹ï¼šç«¯å£ï¼›
2. åè®®å’Œç«¯å£ï¼šTCPï¼Œç‰¹å®šæœ¬åœ°ç«¯å£ï¼š2233ï¼›
3. æ“ä½œï¼šå…è®¸è¿æ¥ï¼›
4. é…ç½®æ–‡ä»¶ï¼šå…¨é€‰ï¼›
5. åç§°ï¼šä»»æ„ï¼›

## 2.4 æµ‹è¯•

å¯¹äºæœ¬åœ°å’Œå±€åŸŸç½‘å†…çš„ä¸»æœºï¼Œéƒ½å¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤æµ‹è¯•è¿æ¥ï¼š

```bash
# xshell
ssh ubuntuç”¨æˆ·å@ä¸»æœºip:2233
# powershell
ssh ubuntuç”¨æˆ·å@ä¸»æœºip -p 2233
```

> æœ¬æœºipåœ°å€å¯ä»¥é€šè¿‡ipconfigè·å–ã€‚
> 

## 2.5 VScode è¿æ¥

vscodeçš„SSHæ‰©å±•å¯ä»¥è¿æ¥SSHæœåŠ¡ï¼Œä½†æ˜¯å¯¹äºå¸¦ç«¯å£çš„SSHé…ç½®ï¼Œéœ€è¦æ‰“å¼€è¿œç¨‹è¿æ¥ç•Œé¢ï¼š

![Untitled](WSL2%EF%BC%883%EF%BC%89%E8%BF%9C%E7%A8%8B%E8%AE%BF%E9%97%AE%20e01d94f1d55f421e90c6d532ecdfc55d/Untitled%201.png)

é€‰æ‹©open SSH configuration Fileï¼Œç„¶åé€‰æ‹©ç¬¬ä¸€ä¸ªä½ç½®ï¼Œæ‰“å¼€é…ç½®æ–‡ä»¶ï¼Œæ·»åŠ é…ç½®å¦‚ä¸‹ï¼š

```bash
Host ä¸»æœºip
  HostName ä¸»æœºip
  User ubuntuç”¨æˆ·å
  Port 2233
```

å°±å¯ä»¥æ­£å¸¸é€šè¿‡SSHæœåŠ¡è¿æ¥äº†ã€‚